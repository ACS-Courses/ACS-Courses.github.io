name: ACS Courses Automation Pack

on:
  push:
    branches:
      - main
    paths:
      - '**/*.html'
      - '**/*.png'
      - '**/*.jpg'
      - '**/*.jpeg'
      - '**/*.webp'
      - '**/*.gif'
  schedule:
    - cron: '0 0 * * 0' # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞ Broken Link Check
  workflow_dispatch:

jobs:
  deploy:
    name: Auto Deploy to GitHub Pages
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages   # GitHub Pages branch
          publish_dir: ./           # ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶¨ ‡¶´‡¶æ‡¶á‡¶≤ root ‡¶è ‡¶•‡¶æ‡¶ï‡ßá
          # ‡¶Ø‡¶¶‡¶ø docs/ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá: publish_dir: ./docs

  optimize_images:
    name: Optimize Images
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Optimize all images
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          # ‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú optimize ‡¶π‡¶¨‡ßá
          paths: '**/*.{png,jpg,jpeg,webp,gif}'

  ping:
    name: Notify Search Engines
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - name: Notify Google
        run: curl -X POST "https://www.google.com/ping?sitemap=https://acspromocodes.com/sitemap.xml"
      - name: Notify Bing
        run: curl -X GET "https://www.bing.com/ping?sitemap=https://acspromocodes.com/sitemap.xml"

  linkcheck:
    name: Broken Link Check
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - uses: actions/checkout@v4
      - name: Run Link Checker
        uses: lycheeverse/lychee-action@v1.8.0
        with:
          args: --verbose --no-progress .

  notify:
    name: Email Notification
    runs-on: ubuntu-latest
    needs: [ping, optimize_images, linkcheck]
    steps:
      - name: Send Email on Update
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: "ACS Courses site updated!"
          to: abujeshan1139181@gmail.com
          from: "ACS Automation <${{ secrets.MAIL_USERNAME }}>"
          body: |
            ‚úÖ Your website (acs-courses.github.io) has been updated and search engines have been notified.
            üïì Time: ${{ github.event.head_commit.timestamp }}
            üöÄ Keep growing!
