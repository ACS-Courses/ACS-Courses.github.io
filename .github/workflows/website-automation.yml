name: Website Automation

permissions:
  contents: write

on:
  push:
    branches:
      - main
    paths:
      - '**/*.html'
      - '**/*.png'
      - '**/*.jpg'
      - '**/*.jpeg'
      - '**/*.webp'
      - '**/*.gif'
  schedule:
    - cron: '0 0 * * 0' # à¦ªà§à¦°à¦¤à¦¿ à¦°à¦¬à¦¿à¦¬à¦¾à¦° à¦¸à§à¦¬à§Ÿà¦‚à¦•à§à¦°à¦¿à§Ÿ à¦šà§‡à¦•
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸš€ Auto Deploy to GitHub Pages
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages
          publish_dir: ./

  optimize_images:
    name: ğŸ–¼ï¸ Optimize Images
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Optimize all images
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          paths: '**/*.{png,jpg,jpeg,webp,gif}'

  ping:
    name: ğŸŒ Notify Search Engines
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - name: Notify Google
        run: curl -X POST "https://www.google.com/ping?sitemap=https://acspromocodes.com/sitemap.xml"
      - name: Notify Bing
        run: curl -X GET "https://www.bing.com/ping?sitemap=https://acspromocodes.com/sitemap.xml"

  linkcheck:
    name: ğŸ”— Check Broken Links
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - uses: actions/checkout@v4
      - name: Check broken links
        uses: lycheeverse/lychee-action@v2
        continue-on-error: true
        with:
          args: --verbose --no-progress --max-redirects 5 --exclude-mail --accept 200,206,301,302,307,308 ./
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  notify:
    name: ğŸ“§ Send Email Notification
    runs-on: ubuntu-latest
    needs: [ping, optimize_images, linkcheck]
    steps:
      - name: Send Email on Update
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: "âœ… ACS Courses Updated!"
          to: abujeshan1139181@gmail.com
          from: "ACS Automation <${{ secrets.MAIL_USERNAME }}>"
          body: |
            ğŸ‰ Your website (https://acs-courses.github.io) has been updated!
            ğŸ•“ Time: ${{ github.event.head_commit.timestamp }}
            ğŸŒ Search engines have been notified.
            ğŸ§© Images optimized and broken links checked.
            ğŸš€ Keep growing!
